<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Chat Channel List</title>
  <style>
    body{font-family: Arial, sans-serif;background:#f5f7fa;margin:0;padding:20px;}
    h1{text-align:center;margin-bottom:20px;}
    .container{max-width:1200px;margin:0 auto;background:#fff;padding:20px;border-radius:10px;box-shadow:0 4px 10px rgba(0,0,0,0.05)}
    table{width:100%;border-collapse:collapse;margin-top:20px;}
    th,td{padding:12px;border-bottom:1px solid #ddd;text-align:left;vertical-align:top;}
    th{background:#f0f2f5;}
    tr:hover{background:#f9fafb;cursor:pointer;}
    .pagination{display:flex;justify-content:center;align-items:center;margin-top:20px;gap:10px;}
    button{background:#007bff;color:#fff;border:none;padding:8px 12px;border-radius:5px;cursor:pointer;}
    button:disabled{background:#ccc;cursor:not-allowed;}
    select{padding:6px;border-radius:5px;border:1px solid #ccc;}
    /* Modal */
    .modal {display:none;position:fixed;z-index:999;left:0;top:0;width:100%;height:100%;overflow:auto;
            background-color:rgba(0,0,0,0.5);}
    .modal-content {background:#fff;margin:10% auto;padding:20px;border-radius:10px;max-width:800px;max-height:80vh;overflow:auto;}
    .close {color:#aaa;float:right;font-size:28px;font-weight:bold;cursor:pointer;}
    pre {background:#f4f4f4;padding:10px;border-radius:5px;white-space:pre-wrap;word-wrap:break-word;}
  </style>
</head>
<body>
  <div class="container">
    <h1>Chat Channel List</h1>
    <div style="display:flex;justify-content:space-between;align-items:center;">
      <div>
        Show <select id="limitSelect">
          <option value="5">5</option>
          <option value="10" selected>10</option>
          <option value="20">20</option>
        </select> entries
      </div>
    </div>
    <table>
      <thead>
        <tr>
          <th>ID</th>
          <th>Name</th>
          <th>Room Type</th>
          <th>Group</th>
          <th>External ID</th>
          <th>Created At</th>
          <th>Last Sender Name</th>
          <th>Message Content</th>
        </tr>
      </thead>
      <tbody id="tableBody">
        <tr><td colspan="8" style="text-align:center;">Loading...</td></tr>
      </tbody>
    </table>
    <div class="pagination">
      <button id="prevBtn">Prev</button>
      <span id="pageInfo"></span>
      <button id="nextBtn">Next</button>
    </div>
  </div>

  <!-- Modal -->
  <div id="jsonModal" class="modal">
    <div class="modal-content">
      <span class="close">&times;</span>
      <h2>Raw JSON</h2>
      <pre id="jsonOutput"></pre>
    </div>
  </div>

  <script>
    const API_URL = 'https://gopher.bicarakan.id/brown/conversation/channel/list';
    const HEADERS = {
      'Content-type': 'application/json',
      'x-api-key': 'B3mJnGSf.zYPOv6oxB4tUlFvwqK3o1DeCeNDivkTT',
      'App-Version-Code': '125',
      'App-Version-Name': '0.12.5',
      'locale': 'en_US',
      'platform': 'Android',
      'Accept-Language': 'id-ID,id;q=0.9,en-US;q=0.8,en;q=0.7',
      'Content-Language': 'id-ID',
      'User-Agent': 'Mozilla/5.0',
      'Authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE3NzAyMzUxMzQsImlhdCI6MTc1NDQ2NzEzNCwianRpIjoiMGQyN2ZlODFjMTJmNDlhMGE2MTUwNTFjNGNlMmJhYTEiLCJ0b2tlbl90eXBlIjoiYWNjZXNzIiwidXNlcl9pZCI6IjM1MDc0ZTRkLTUxYWEtNDI5Mi04NjNlLWUzY2YyNDI0NzU2MSJ9.BFb2_XihWzAASabKaeSaXofT0O0IMiL5G2KayDtEtb8'
    };

    let offset = 0;
    let limit = 10;
    let currentData = [];

    const tableBody = document.getElementById('tableBody');
    const pageInfo = document.getElementById('pageInfo');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const limitSelect = document.getElementById('limitSelect');

    const modal = document.getElementById('jsonModal');
    const modalClose = document.querySelector('.close');
    const jsonOutput = document.getElementById('jsonOutput');

    modalClose.onclick = () => modal.style.display = 'none';
    window.onclick = (event) => { if (event.target == modal) modal.style.display = 'none'; };

    async function fetchData() {
      pageInfo.textContent = `Page ${Math.floor(offset/limit) + 1}`;
      prevBtn.disabled = offset === 0;
      tableBody.innerHTML = `<tr><td colspan="8" style="text-align:center;">Loading...</td></tr>`;
      try {
        const res = await fetch(API_URL, {
          method: 'POST',
          headers: HEADERS,
          body: JSON.stringify({ filter_chat: {}, offset, limit })
        });
        const json = await res.json();
        currentData = json.data?.chat_channel_summary_list || [];
        if (currentData.length === 0) {
          tableBody.innerHTML = `<tr><td colspan="8" style="text-align:center;">No data</td></tr>`;
          return;
        }
        tableBody.innerHTML = currentData.map((c, index) => `
          <tr data-index="${index}">
            <td>${c.id}</td>
            <td>${c.room_name || ''}</td>
            <td>${c.room_type || ''}</td>
            <td>${c.is_group ? 'Yes' : 'No'}</td>
            <td>${c.external_id || ''}</td>
            <td>${new Date(c.created_at).toLocaleString()}</td>
            <td>${c.last_message?.message_sender?.sender_displayed_name || ''}</td>
            <td>${c.last_message?.message_content || ''}</td>
          </tr>`).join('');

        // Add click event for each row
        document.querySelectorAll('#tableBody tr').forEach(row => {
          row.addEventListener('click', () => {
            const idx = row.getAttribute('data-index');
            const rawJson = JSON.stringify(currentData[idx], null, 2);
            jsonOutput.textContent = rawJson;
            modal.style.display = 'block';
          });
        });

      } catch (err) {
        tableBody.innerHTML = `<tr><td colspan="8" style="text-align:center; color:red;">Error: ${err.message}</td></tr>`;
      }
    }

    prevBtn.addEventListener('click', () => { offset = Math.max(0, offset - limit); fetchData(); });
    nextBtn.addEventListener('click', () => { offset += limit; fetchData(); });
    limitSelect.addEventListener('change', (e) => { limit = parseInt(e.target.value); offset = 0; fetchData(); });

    fetchData();
  </script>
</body>
</html>
