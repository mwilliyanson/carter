<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <title>Login - Bicarakan</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-r from-indigo-100 to-blue-100 min-h-screen flex items-center justify-center">
  <div class="bg-white p-8 rounded-xl shadow-lg w-full max-w-sm">
    <h1 class="text-2xl font-bold text-center text-indigo-700 mb-6">Login ke Bicarakan</h1>
    <form id="loginForm" class="space-y-4">
      <div>
        <label class="block text-indigo-600 font-semibold mb-1">Nomor Telepon</label>
        <input type="text" id="username" required placeholder="628xxxxxxxxx" class="w-full border border-indigo-300 rounded-md p-2 focus:outline-none focus:ring-2 focus:ring-indigo-500" />
      </div>

      <div>
        <label class="block text-indigo-600 font-semibold mb-1">Password</label>
        <input type="password" id="password" required class="w-full border border-indigo-300 rounded-md p-2 focus:outline-none focus:ring-2 focus:ring-indigo-500" />
      </div>

      <button type="submit" class="w-full bg-indigo-600 text-white font-bold py-2 px-4 rounded-md hover:bg-indigo-700 transition duration-200">
        Login
      </button>
    </form>

    <div id="loginMessage" class="mt-4 text-center text-sm font-medium"></div>
  </div>

  <script>
    const form = document.getElementById("loginForm");
    const loginMessage = document.getElementById("loginMessage");

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      const username = document.getElementById("username").value;
      const password = document.getElementById("password").value;

      const body = {
        username,
        password,
        access_type: "PHONE_PASSWORD",
        application_identifier: "BCRA",
        access_meta_data: {
          external_token_id: ""
        },
        device_meta_data: {
          token: "",
          device_id: "",
          type: "web"
        }
      };

      try {
        const res = await fetch("https://gopher.bicarakan.id/stansbury/user/login", {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify(body)
        });

        const result = await res.json();

        if (result.data?.sign_in_status === "SUCCESS") {
          const token = result.data.token_context.access_token_context.token_data;
          const userId = result.data.user_login_data.user_id;

          // Store token and user ID
          localStorage.setItem("access_token", token);
          localStorage.setItem("user_id", userId);

          // Redirect
          window.location.href = "pengajuan.html";
        } else {
          loginMessage.textContent = "Login gagal. Periksa kembali nomor dan password Anda.";
          loginMessage.className = "text-red-600 text-center mt-4";
        }
      } catch (err) {
        loginMessage.textContent = "Terjadi kesalahan. Silakan coba lagi.";
        loginMessage.className = "text-red-600 text-center mt-4";
      }
    });
  </script>
</body>
</html>
